<head>
  <title>Malawi Vaccine Cold Chain</title>
  <%= stylesheet_link_tag    "style", :media => "all" %>
  <%= javascript_include_tag "setup" %>
  <%= javascript_include_tag "utility" %>
  <%= csrf_meta_tags %>
</head>
<body>
    <a href="map?id=<%= @id %>">Map</a>
    <span id="your_id"></span>
    <div id="tabs">
        <ul>
            <li><a href="#files">Files</a></li>
            <li><a href="#fields">Fields</a></li>
            <li><a href="#values">Values</a></li>
            <li><a href="#gps">GPS</a></li>
            <li><a href="#info_box">Info box</a></li>
            <li><a href="#map_display">Mappings</a></li>
            <li><a href="#filter_display">Filters</a></li>
            <li><a href="#size_display">Sizes</a></li>
        </ul>
        <div id="files">
		  <table id="specify_files">
			<thead>
			  <tr>
				<th>Type of file</th>
				<th>Name of file</th>
				<th>Human-readable name</th>
				<th>Main column name</th>
				<th>Join with this facility file column</th>
			  </tr>
			</thead>
			<tbody>
			  <%= render :partial => "select_file_row",
			             :locals => { :type => "facility",
			                          :type_name => "Facilities",
			                          :file_name => @facility_options.file_name,
			                          :main_col => @facility_options.main_col,
			                          :allow_join_set => false,
			                          :allow_name_set => false } %>
			  <%= render :partial => "select_file_row",
			             :locals => { :type => "fridge",
			                          :type_name => "Fridges",
			                          :file_name => @fridge_options.file_name,
			                          :main_col => @fridge_options.main_col,
			                          :join => @fridge_options.join_main,
			                          :allow_join_set => true,
			                          :allow_name_set => false } %>
			  <% if !@schedule_options.file_names.nil? %>
			    <% @schedule_options.file_names.each do |f| %>
			      <%= render :partial => "select_file_row",
			                 :locals => { :type => "schedule",
			                              :type_name => "Schedule",
			                              :file_name => f,
			                              :main_col => @schedule_options.main_col,
			                              :join => @schedule_options.join_main,
			                              :file_readable_name => @schedule_options.file_readable_names[f],
			                              :allow_join_set => true,
			                              :allow_name_set => true } %>
				<% end %>
			  <% end %>
			</tbody>
		  </table>
		  <%= link_to_function "Add schedule", "addFileRow('Schedule', true, null, 'schedule')" %>
        </div>
        <div id="fields">
		  <%= render :partial => "select_fields_table",
		             :locals => { :header => "Facilities",
		                          :id => "fields_facility",
		                          :all_fields => @all_facility_fields,
		                          :options_fields => @options_facility_fields,
		                          :options_id => @facility_options.id,
		                          :options_type => "FacilityOptions" } %>
		  <%= render :partial => "select_fields_table",
		             :locals => { :header => "Fridges",
		                          :id => "fields_fridge",
		                          :all_fields => @all_fridge_fields,
		                          :options_fields => @options_fridge_fields,
		                          :options_id => @fridge_options.id,
		                          :options_type => "FridgeOptions" } %>
		  <%= render :partial => "select_fields_table",
		             :locals => { :header => "Schedules",
		                          :id => "fields_schedule",
		                          :all_fields => @all_schedule_fields,
		                          :options_fields => @options_schedule_fields,
		                          :options_id => @schedule_options.id,
		                          :options_type => "ScheduleOptions" } %>
        </div>
        <div id="gps">
		  <p>Latitude: <select id="lat">
			  <% @options_facility_fields.each do |f| %>
			    <option <% if @user_options.lat == f.name %>selected="selected"<% end %> ><%= f.name %></option>
		      <% end %>
			</select>
		  </p>
		  <p>Longitude: <select id="lon">
			  <% @options_facility_fields.each do |f| %>
			    <option <% if @user_options.lon == f.name %>selected="selected"<% end %> ><%= f.name %></option>
		      <% end %>
			</select>
		  </p>
		  <p>UTM? <input type="checkbox" id="is_utm" <% if @user_options.is_utm %>checked="checked"<% end %> />
			  Zone <input type="text" id="zone" <% if @user_options.is_utm %>value="<%= @user_options.zone %>"<% end %> />
			  Southern hemi? <input type="checkbox" id="south_hemi" <% if @user_options.south_hemi %>checked="checked"<% end %> />
		  </p>
		  <p>Center of map: Latitude <input type="text" id="lat_center" <% if @user_options.lat_center %>value="<%= @user_options.lat_center %>"<% end %> />
			                Latitude <input type="text" id="lon_center" <% if @user_options.lon_center %>value="<%= @user_options.lon_center %>"<% end %> />
		</div>
        <div id="values">
        </div>
        <div id="info_box">
		  <table>
			<thead>
			  <tr>
				<th>Field</th>
			  </tr>
			</thead>
			<tbody>
			  <% if !@info_box.nil? %>
			  <%= render :partial => "info_box_row",
		                 :locals => { :facility_fields => @options_facility_fields,
				                      :fridge_fields => @options_fridge_fields,
                                      :schedule_fields => @options_schedule_fields,
		                              :first => true,
				                      :selected => @info_box.title_field,
				                      :f_type => "facility" } %>
			  <% @info_box.data.each do |f| %>
  			    <%= render :partial => "info_box_row",
		                   :locals => { :facility_fields => @options_facility_fields,
				                        :fridge_fields => @options_fridge_fields,
                                        :schedule_fields => @options_schedule_fields,
		                                :first => false,
				                        :selected => f["field"],
				                        :f_type => f["type"] } %>
			  <% end %>
			  <% end %>
			</tbody>
		  </table>
		  <%= link_to_function "Add info box row", "addInfoBoxRow(#{@options_facility_fields.as_json}, #{@options_fridge_fields.as_json}, #{@options_schedule_fields.as_json})" %>
        </div>
		<div id="map_display">
          <span id="instructions"></span>
		  <% if !@maps.nil? %>
		  <% @maps.each do |m| %>
		    <%= render :partial => "map_display_div",
		               :locals => { :name => m.data[0],
			                        :mapper => m.data[1].split(%r{\s*,,,\s*}),
			                        :conds => m.data[2..-1],
			                        :colors => ["red", "orange", "yellow", "green", "blue", "black", "white"],
                                    :facility_fields => @options_facility_fields,
				                    :fridge_fields => @options_fridge_fields,
                                    :schedule_fields => @options_schedule_fields } %>
		  <% end %>
		  <% end %>
		  <%= link_to_function "Add map display", "addMapDisplay(#{@options_facility_fields.as_json}, #{@options_fridge_fields.as_json}, #{@options_schedule_fields.as_json})" %>
		</div>
		<div id="filter_display">
          <span id="instructions"></span>
		  <% if !@filters.nil? %>
		  <% @filters.each do |filter| %>
		    <%= render :partial => "filter_display_div",
		               :locals => { :name => filter.data[0],
			                        :filter => filter.data[1].split(%r{\s*,,,\s*}),
			                        :conds => filter.data[2..-1],
                                    :facility_fields => @options_facility_fields,
				                    :fridge_fields => @options_fridge_fields,
                                    :schedule_fields => @options_schedule_fields } %>
		  <% end %>
		  <% end %>
		  <%= link_to_function "Add filter display", "addFilterDisplay(#{@options_facility_fields.as_json}, #{@options_fridge_fields.as_json}, #{@options_schedule_fields.as_json})" %>
		</div>
		<div id="size_display">
		</div>
	<%= link_to_function "Submit New", "submitUserOptions(false)" %> | 
	<%= link_to_function "Update", "submitUserOptions(true)" %>

    </div>

</body>
